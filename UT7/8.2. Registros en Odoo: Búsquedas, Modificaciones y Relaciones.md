# Registros en Odoo: Búsquedas, Modificaciones y Relaciones

En Odoo, los **domains**, la función **search()**, y los métodos **browse()**, **read()**, **write()**, y **unlink()** son herramientas clave para interactuar con los registros en la base de datos. A continuación, se explican cómo usarlos con ejemplos prácticos.

## ¿Qué es un Domain en Odoo?

Un **domain** en Odoo es una lista de condiciones que se utiliza para filtrar los registros de los modelos. Los domains permiten que las consultas sean más precisas, lo que facilita la obtención de los registros que cumplen con ciertos criterios.

### Sintaxis de un Domain

Un domain en Odoo se define como una lista de tuplas, donde cada tupla describe una condición que debe cumplirse. La sintaxis básica es la siguiente:

```python
[('campo', 'operador', 'valor')]
```

- **campo**: El nombre del campo en el modelo.
- **operador**: El operador de comparación (por ejemplo, '=', '>', '<', 'in', 'like').
- **valor**: El valor con el que se compara el campo.

### Ejemplos de Domains

1. **Filtrar registros con un campo específico**:
   ```python
   domain = [('state', '=', 'draft')]
   ```

2. **Filtrar con múltiples condiciones**:
   ```python
   domain = [('state', '=', 'draft'), ('amount_total', '>', 1000)]
   ```

3. **Filtrar por un campo de fecha**:
   ```python
   domain = [('date_order', '>=', '2024-01-01')]
   ```

4. **Filtrar con `like` para coincidencias parciales**:
   ```python
   domain = [('name', 'like', 'Odoo')]
   ```
5. **Filtrar con `id`**:  
   Para este ejemplo, supongamos que tenemos un modelo ciudad, que contiene un campo para saber a qué país pertenece y en nuestro modelo de país queremos poder seleccionar cuál será la capital, de entre todas las ciudades que pertenecen a nuestro país.
   ```python
   class Country(models.Model):
       _name = 'res.country'
       name = fields.Char(string='Country Name')
       capital_city = fields.Many2one(
           comodel_name='city',
           string='Capital',
           domain="[('country_id', '=', id)]"
       )
   ```
---

## ¿Qué es `search()` en Odoo?

La función **`search()`** se utiliza para realizar consultas en la base de datos, buscando registros que coincidan con las condiciones definidas en un domain.

### Sintaxis de `search()`

```python
records = model.search(domain)
```

- **model**: El modelo sobre el que se va a realizar la búsqueda (por ejemplo, `res.partner` para los contactos).
- **domain**: El domain que contiene las condiciones de la búsqueda.

### Ejemplos de `search()`

```python
# Buscar registros con un estado específico
partners = env['res.partner'].search([('state', '=', 'draft')])

# Buscar múltiples registros con múltiples condiciones
orders = env['sale.order'].search([('state', '=', 'draft'), ('amount_total', '>', 1000)])

# Obtener solo los primeros resultados
first_five = env['sale.order'].search([('state', '=', 'draft')], limit=5)

# Buscar registros por un campo de fecha
orders = env['sale.order'].search([('date_order', '>=', '2024-01-01')])
```

---

## ¿Qué es `browse()` en Odoo?

El método **`browse()`** se utiliza para acceder a registros específicos de la base de datos directamente mediante sus identificadores (IDs), sin necesidad de realizar una búsqueda completa.

### Sintaxis de `browse()`

```python
record = model.browse(ids)
```

- **ids**: Una lista de IDs de los registros que deseas acceder.

### Ejemplo de `browse()`

```python
# Acceder a los registros con ID 1 y 2
records = env['res.partner'].browse([1, 2])
```

Este método devolverá los registros con los IDs especificados, sin necesidad de realizar una búsqueda.

---

## ¿Qué es `read()` en Odoo?

El método **`read()`** permite recuperar los valores de campos específicos de los registros sin cargar los objetos completos. Esto puede ser más eficiente cuando solo se necesitan ciertos campos.

### Sintaxis de `read()`

```python
record_values = model.read(fields)
```

- **fields**: Una lista de nombres de campos que deseas obtener.

### Ejemplo de `read()`

```python
# Obtener los campos 'name' y 'email' de los registros con ID 1 y 2
records = env['res.partner'].browse([1, 2]).read(['name', 'email'])
print(records)  # [{'name': 'Juan', 'email': 'juan@example.com'}, {'name': 'Ana', 'email': 'ana@example.com'}]
```

Este método es útil cuando solo necesitas leer ciertos campos de los registros y no quieres cargar todos los datos asociados.

---

## Funciones adicionales útiles

### `write()`: Modificar registros

El método **`write()`** se utiliza para actualizar uno o más registros existentes en la base de datos. Debes pasar un diccionario donde las claves son los nombres de los campos a modificar y los valores son los nuevos valores.

### Sintaxis de `write()`

```python
record.write({'campo': 'valor'})
```

- **campo**: El nombre del campo a actualizar.
- **valor**: El nuevo valor que deseas asignar al campo.

### Ejemplo de `write()`

Imagina que quieres actualizar el campo `state` de un pedido (`sale.order`) y establecerlo como `'done'`.

```python
# Actualizar el estado del pedido con ID 1
order = env['sale.order'].browse([1])
order.write({'state': 'done'})
```

Este código busca el pedido con el ID 1 y cambia su estado a `'done'`.

### `unlink()`: Eliminar registros

El método **`unlink()`** se utiliza para eliminar uno o más registros de la base de datos. Se debe tener mucho cuidado al usarlo, ya que elimina los registros permanentemente.

### Sintaxis de `unlink()`

```python
record.unlink()
```

### Ejemplo de `unlink()`

Si deseas eliminar un registro de un modelo, puedes usar el siguiente código:

```python
# Eliminar el registro de la base de datos con ID 1
order = env['sale.order'].browse([1])
order.unlink()
```

Este código elimina permanentemente el pedido con el ID 1.

---

## Ejemplo de `domain` con `id`

En Odoo, los **domains** también pueden hacer referencia a `id`, lo que permite filtrar registros basados en relaciones. Un ejemplo común es el uso de un **campo `Many2one`**, donde se seleccionan registros relacionados por su `id`.

### Ejemplo de campo `Many2one` con `domain`

Imagina un modelo de **países** y un modelo de **ciudades**, donde cada ciudad pertenece a un país. Queremos crear un campo en el modelo de **países** que permita seleccionar la capital, pero solo mostrar las ciudades que pertenezcan al país actual.

```python
class Country(models.Model):
    _name = 'res.country'
    name = fields.Char(string='Country Name')
    capital_city = fields.Many2one(
        comodel_name='city',
        string='Capital',
        domain="[('country_id', '=', id)]"
    )
```

En este ejemplo, el campo `capital_city` es un campo `Many2one` que permite seleccionar una ciudad de la lista de ciudades relacionadas con el país actual. El `domain` aplicado asegura que solo se mostrarán las ciudades cuyo campo `country_id` coincida con el `id` del país actual.

---

## Funciones adicionales útiles

- **`limit`**: Establece el número máximo de registros que se devolverán. Por defecto, `search()` devuelve todos los registros que coinciden con el domain.
  
```python
limit = 10  # Devuelve un máximo de 10 registros
```

- **`order`**: Permite ordenar los resultados según un campo. Si no se especifica, los resultados no estarán ordenados.

```python
order = 'field_name asc'  # Orden ascendente
order = 'field_name desc'  # Orden descendente
```

- **`offset`**: Permite omitir un número determinado de registros al principio de los resultados. Esto es útil para la paginación.

```python
offset = 20  # Omite los primeros 20 registros
```

---

Si tienes más preguntas sobre `search()`, `browse()`, `read()`, `write()`, `unlink()`, o cualquier otro aspecto de la manipulación de datos en Odoo, ¡no dudes en preguntar!
